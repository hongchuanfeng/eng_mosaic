<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link id="favicon" rel="icon" type="image/png" href="favicon.ico">
    <title>Online free image mosaic - Free Image Mosaic Tool</title>
    <meta name="keywords" content="online free image mosaic, mosaic tool, pixelate image, mosaic editor, privacy blur, pixel art" />
    <meta name="description" content="Online free image mosaic tool to pixelate images, support full mosaic, rectangle area and brush, download in one click." />
    <link rel="canonical" href="https://mosaic.chdaoai.com/">
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-CB0W88E8NY"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-CB0W88E8NY');
</script>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7274710287377352"
     crossorigin="anonymous"></script>
    <link rel="stylesheet" href="css.css">
    <style>
        /* é¡µé¢é•¿åº¦é€‚å½“åŠ é•¿ */
        body { min-height: 120vh; }
        .main-div { padding-bottom: 48px; }
        /* åŸºç¡€å¸ƒå±€ */
        .navbar { position: relative; z-index: auto; }
        .nav-container { display: flex; align-items: center; justify-content: space-between; }
        .nav-menu { display: flex; flex-wrap: wrap; gap: 8px; }
        .nav-link { padding: 0; display: inline-flex; align-items: center; }
        .nav-ico { display: inline-block; margin-right: 0; font-size: 16px; line-height: 1; }
        .nav-toggle { display: none; background: transparent; border: none; padding: 8px; cursor: pointer; }
        .hamburger { display: block; width: 22px; height: 2px; background: rgba(255, 255, 255, 0.9); margin: 5px 0; transition: transform .25s ease, opacity .25s ease; }
        .nav-overlay { display: none; }

        /* PCç«¯ nav-link é—´è· */
        @media (min-width: 769px) {
            .nav-link { padding: 5px 12px; }
            .nav-menu {
                gap: 8px;
            }
            .nav-item {
                display: inline-block;
            }
        }

        /* æ¡Œé¢ç«¯åŠ å®½ç‰ˆé¢ï¼Œé¿å…å¯¼èˆªæ‹¥æŒ¤ */
        @media (min-width: 1025px) {
            html, body { min-width: 1600px; }
            .header-div, .main-div, .navbar, .nav-container { max-width: none; }
        }

        /* Language switch (CN) - ä¼˜åŒ–ç‰ˆæœ¬ */
        .lang-switch {
            position: relative;
            z-index: 2;
            text-decoration: none;
            user-select: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            height: 40px;
            padding: 0 16px;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: rgba(255, 255, 255, 0.95);
            margin-left: 12px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 14px;
            font-weight: 500;
            gap: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        .lang-switch:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
        }
        .lang-switch:active {
            transform: translateY(0);
        }
        .lang-switch .ls-left {
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        .lang-switch .badge {
            background: rgba(255, 255, 255, 0.2);
            padding: 4px 10px;
            border-radius: 6px;
            font-weight: 700;
            font-size: 12px;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }
        .lang-switch .divider {
            width: 1px;
            height: 16px;
            background: rgba(255, 255, 255, 0.3);
        }
        .lang-switch .label {
            font-size: 13px;
            font-weight: 500;
        }
        .lang-switch .ls-right {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-left: 4px;
        }
        .lang-switch .arrow {
            display: inline-block;
            width: 0;
            height: 0;
            border-left: 5px solid transparent;
            border-right: 5px solid transparent;
            border-top: 5px solid rgba(255, 255, 255, 0.9);
            transition: transform 0.3s ease;
        }
        .lang-switch:hover .arrow {
            transform: translateY(2px);
        }
        @media (max-width: 768px) {
            .lang-switch {
                position: fixed;
                right: 12px;
                /* top: 0px; */
                height: 38px;
                padding: 0 14px;
                z-index: 10002;
                font-size: 13px;
            }
            .lang-switch .badge {
                font-size: 11px;
                padding: 3px 8px;
            }
            .lang-switch .label {
                font-size: 12px;
            }
        }

        /* ä¸‹æ‹‰èœå•æ ·å¼ */
        .nav-item { 
            position: relative; 
            display: inline-block;
        }
        .dropdown-toggle { 
            cursor: pointer; 
            user-select: none;
        }
        .dropdown-menu {
            position: absolute;
            top: calc(100% + 4px);
            left: 50%;
            transform: translateX(-50%);
            background: #fff;
            min-width: 600px;
            box-shadow: 0 4px 12px rgba(0,0,0,.15);
            border-radius: 8px;
            padding: 16px;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s ease, visibility 0.2s ease;
            z-index: 1000;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            pointer-events: none;
            overflow: visible;
            max-height: none;
            height: auto;
        }
        /* èœå•æ˜¾ç¤ºæ—¶ */
        .nav-item:hover .dropdown-menu,
        .nav-item.dropdown-open .dropdown-menu {
            opacity: 1;
            visibility: visible;
            pointer-events: auto;
        }
        /* ä¸‹æ‹‰èœå•é“¾æ¥æ ·å¼ */
        .dropdown-menu .nav-link {
            display: block;
            padding: 12px 16px;
            color: #333;
            text-decoration: none;
            background: transparent;
            border-radius: 6px;
            font-size: 13px;
            white-space: nowrap;
            transition: background-color 0.2s ease;
            margin: 0;
            text-align: center;
            cursor: pointer;
        }
        .dropdown-menu .nav-link:hover {
            background: #f5f5f5;
            color: #007bff;
        }
        .dropdown-toggle::after {
            content: ' â–¼';
            font-size: 10px;
            margin-left: 4px;
            opacity: 0.7;
        }
        
        /* ä¸­ç­‰å±å¹•å“åº”å¼è®¾è®¡ï¼ˆå¹³æ¿ï¼‰ */
        @media (min-width: 769px) and (max-width: 1024px) {
            .dropdown-menu {
                min-width: 480px;
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        /* å¤§å±å¹•æ˜¾ç¤º4åˆ— */
        @media (min-width: 1025px) {
            .dropdown-menu {
                min-width: 600px;
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        /* å¯¼èˆªæ å›¾æ ‡æ ·å¼ */
        .dropdown-toggle::before,
        .nav-link[href="about.html"]::before,
        .nav-link[href="contact.html"]::before {
            display: inline-block;
            margin-right: 6px;
            font-size: 16px;
            line-height: 1;
        }
        .dropdown-toggle::before {
            content: "ğŸ¤–";
        }
        .nav-link[href="about.html"]::before {
            content: "â„¹ï¸";
        }
        .nav-link[href="contact.html"]::before {
            content: "ğŸ“§";
        }
        
        /* ç¡®ä¿ä¸‹æ‹‰èœå•åœ¨å¯¼èˆªæ ä¸­æ­£ç¡®æ˜¾ç¤º */
        @media (min-width: 769px) {
            .nav-item .dropdown-toggle {
                color: rgba(255, 255, 255, 0.9);
                background-color: rgba(255, 255, 255, 0.08);
                border: 1px solid rgba(255, 255, 255, 0.1);
                border-radius: 8px;
                padding: 8px 16px;
                display: inline-block;
                font-weight: 500;
            }
            .nav-item:hover .dropdown-toggle {
                background-color: rgba(255, 255, 255, 0.15);
                color: #fff;
            }
        }

        /* ç§»åŠ¨ç«¯æŠ½å±‰èœå• */
        @media (max-width: 768px) {
            /* é¿å…çˆ¶çº§è£å‰ªæˆ–åˆ›å»ºæ–°å®šä½ä¸Šä¸‹æ–‡å¯¼è‡´æŠ½å±‰è¢«æˆªæ–­ */
            .header-div, .navbar, .nav-container { overflow: visible !important; }
            .header-div, .navbar, .nav-container { transform: none !important; -webkit-transform: none !important; }
            .header-div, .navbar, .nav-container { contain: unset !important; }
            .nav-toggle { display: inline-block; }
            .nav-menu {
                position: fixed; top: 0; bottom: 0; left: 0; width: 85%; max-width: 420px;
                background: #fff; box-shadow: 2px 0 10px rgba(0,0,0,.12);
                display: block; padding: calc(env(safe-area-inset-top,0) + 12px) 12px 24px; overflow-y: auto; -webkit-overflow-scrolling: touch;
                transform: translateX(-100%); transition: transform .25s ease; z-index: 10001; will-change: transform;
            }
            .nav-menu .nav-link { display: flex; align-items: center; padding: 0; border-bottom: 1px solid #f2f2f2; }
            .nav-menu.nav-menu-active { transform: translateX(0); }

            .nav-overlay { position: fixed; inset: 0; background: rgba(0,0,0,.4); opacity: 0; pointer-events: none; transition: opacity .2s ease; z-index: 10000; display: block; }
            .nav-overlay.nav-overlay-active { opacity: 1; pointer-events: auto; }

            /* æ±‰å ¡åŠ¨ç”» */
            .nav-toggle.nav-toggle-active .hamburger:nth-child(1) { transform: translateY(7px) rotate(45deg); }
            .nav-toggle.nav-toggle-active .hamburger:nth-child(2) { opacity: 0; }
            .nav-toggle.nav-toggle-active .hamburger:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }
            /* ç§»åŠ¨ç«¯ä¸Šä¸‹é—´éš™ï¼ˆPC ç«¯ä¸ç”Ÿæ•ˆï¼‰ */
            .nav-menu .nav-link { margin: 10px 0; }
            
            /* ç§»åŠ¨ç«¯ä¸‹æ‹‰èœå•æ ·å¼ */
            .nav-item {
                width: 100%;
                border-bottom: 1px solid #f2f2f2;
            }
            .dropdown-toggle {
                width: 100%;
                display: flex;
                align-items: center;
                padding: 16px 20px;
                color: #333;
                background: white;
                border: none;
                text-align: left;
                font-size: 1rem;
                font-weight: 500;
                margin: 0;
            }
            .dropdown-menu {
                position: static;
                opacity: 0;
                visibility: hidden;
                max-height: 0;
                transform: none;
                box-shadow: none;
                background: #f8f9fa;
                margin: 0;
                padding: 0;
                overflow: hidden;
                transition: opacity 0.3s ease, max-height 0.3s ease;
                border-radius: 0;
                display: block !important;
                grid-template-columns: 1fr !important;
                min-width: auto !important;
            }
            .nav-item.dropdown-open .dropdown-menu {
                opacity: 1;
                visibility: visible;
                max-height: 2000px;
            }
            .dropdown-menu .nav-link {
                padding: 12px 20px 12px 40px;
                font-size: 14px;
                border-bottom: 1px solid #e9ecef;
                color: #333;
                text-align: left;
            }
            .dropdown-menu .nav-link:hover {
                background: #e9ecef;
            }
            
            /* ç§»åŠ¨ç«¯å¯¼èˆªæ å›¾æ ‡ */
            .dropdown-toggle::before,
            .nav-link[href="about.html"]::before,
            .nav-link[href="contact.html"]::before {
                display: inline-block;
                margin-right: 8px;
                font-size: 18px;
            }
        }

        /* Normalize action buttons height and appearance */
        .file-label, #removeMosaicBtn {
            display: inline-flex; align-items: center; justify-content: center;
            height: 44px; padding: 0 20px; line-height: 1; box-sizing: border-box;
            border: none; appearance: none; -webkit-appearance: none; cursor: pointer;
            border-radius: 8px;
        }
    </style>

</head>
<body>
    <header class="header-div">
        <nav class="navbar">
            <div class="nav-container">
                <button class="nav-toggle" id="navToggle" aria-label="Toggle navigation menu">
                    <span class="hamburger"></span>
                    <span class="hamburger"></span>
                    <span class="hamburger"></span>
                </button>
                <div class="nav-menu" id="navMenu">
                    <div class="nav-item">
                        <span class="nav-link dropdown-toggle">Image AI tool</span>
                        <div class="dropdown-menu">
                            <a href="index.html" class="nav-link">Image Mosaic</a>
                            <a href="crop/crop.html" class="nav-link">Crop Image</a>
                            <a href="convert/convert.html" class="nav-link">Format Convert</a>
                            <a href="icon/icon.html" class="nav-link">Icon Generator</a>
                            <a href="compress/compress.html" class="nav-link">Compress Image</a>
                            <a href="blank/blank.html" class="nav-link">Grayscale</a>
                            <a href="watermark/watermark.html" class="nav-link">Add Watermark</a>
                            <a href="removewm/removewm.html" class="nav-link">Remove Watermark</a>
                            <a href="nine/nine.html" class="nav-link">Image Grid</a>
                            <a href="text/text.html" class="nav-link">Text to Image</a>
                            <a href="join/join.html" class="nav-link">Merge Images</a>
                            <a href="textToimage/textToimage.html" class="nav-link">Add Text</a>
                            <a href="corner/corner.html" class="nav-link">Round Corners</a>
                            <a href="expand/expand.html" class="nav-link">Upscale Image</a>
                            <a href="old/old.html" class="nav-link">Restore Photo</a>
                            <a href="bg/bg.html" class="nav-link">Colorize Image</a>
                            <a href="removebg/removebg.html" class="nav-link">Remove Background</a>
                            <a href="changebg/changebg.html" class="nav-link">Change Background</a>
                        </div>
                    </div>
                    <a href="about.html" class="nav-link">About</a>
                    <a href="contact.html" class="nav-link">Contact</a>
                </div>
                <button id="loginBtn" class="lang-switch" style="margin-left:0;margin-right:12px;" aria-label="Sign in with Google">
                    <span class="ls-left">
                        <span class="label" id="loginLabel">Sign in with Google</span>
                    </span>
                </button>
                <a class="lang-switch" href="https://mosaic.openai2025.com/" rel="nofollow" aria-label="Switch to Chinese version">
                    <span class="ls-left">
                        <span class="badge">CN</span>
                        <span class="divider"></span>
                        <span class="label">ä¸­æ–‡</span>
                    </span>
                    <span class="ls-right"><i class="arrow"></i></span>
                </a>
            </div>
        </nav>
        <h1 class="header-title">Image Mosaic</h1>
    </header>

    <!-- ç§»åŠ¨ç«¯èœå•é®ç½©å±‚ -->
    <div class="nav-overlay" id="navOverlay"></div>

    <main class="main-div">
        <section class="frame-div upload-section">
            <div class="frame-top">
                <label for="fileBtn" class="file-label">Choose Image</label>
                <input type="file" id="fileBtn" accept="image/jpeg,image/gif,image/png,image/bmp,image/webp" />
                <button type="button" id="removeMosaicBtn" class="file-label" style="margin-left:8px;">Remove Mosaic</button>
            </div>
            <div class="frame-center" id="leftFrameCenter" style="position:relative">
                <img id="img" alt="Original image" style="display:none"/>
                <canvas id="overlayCanvas" style="display:none;position:absolute;left:0;top:0;pointer-events:auto"></canvas>
                <div class="placeholder-text">Please select an image</div>
            </div>
        </section>
        <section class="frame-div result-section">
            <div class="frame-top">
                <div class="controls-group">
                    <label for="rangeInput" class="range-label">Mosaic strength: <span id="rangeValue">5</span></label>
                    <input type="range" id="rangeInput" min="1" max="10" value="5" />
                </div>
                <div class="controls-group">
                    <label for="modeSelect" class="range-label">Mode:</label>
                    <select id="modeSelect">
                        <option value="full">Full mosaic</option>
                        <option value="rect">Rectangle area</option>
                        <option value="brush">Brush</option>
                    </select>
                </div>
                <div class="controls-group" id="brushGroup" style="display:none">
                    <label for="brushSize" class="range-label">Brush size: <span id="brushValue">30</span></label>
                    <input type="range" id="brushSize" min="5" max="200" value="30" />
                    <button type="button" id="clearMaskBtn" class="download-btn" style="margin-left:8px">Clear selection</button>
                </div>
                <button type="button" id="downloadBtn" class="download-btn">Download image</button>
            </div>
            <div class="frame-center">
                <img id="convertImg" alt="Processed image" style="display:none"/>
                <div class="placeholder-text">The processed image will appear here</div>
            </div>
        </section>
    </main>

    <!-- åŠŸèƒ½è¯´æ˜å’Œä½¿ç”¨å¸®åŠ©éƒ¨åˆ† -->
    <section class="info-section">
        <div class="info-container">
            <!-- åŠŸèƒ½è¯´æ˜ -->
            <div class="info-card">
                <h2>ğŸ“‹ Feature Description</h2>
                <p>Our Image Mosaic tool provides three powerful modes to protect privacy and create artistic effects:</p>
                <ul>
                    <li><strong>Full Mosaic:</strong> Apply mosaic effect to the entire image</li>
                    <li><strong>Rectangle Area:</strong> Select specific rectangular areas to mosaic</li>
                    <li><strong>Brush Mode:</strong> Paint mosaic effects with a customizable brush size</li>
                </ul>
    </div>

            <!-- ä½¿ç”¨å¸®åŠ© -->
            <div class="info-card">
                <h2>ğŸ’¡ Usage Guide</h2>
                <ol>
                    <li>Click "Choose Image" to upload your image</li>
                    <li>Select your preferred mode (Full, Rectangle, or Brush)</li>
                    <li>Adjust the mosaic strength slider (1-10)</li>
                    <li>For Rectangle mode: Click and drag to select areas</li>
                    <li>For Brush mode: Paint over areas you want to mosaic</li>
                    <li>Click "Download image" to save your processed image</li>
                </ol>
            </div>

            <!-- ä½¿ç”¨æ¡ˆä¾‹ -->
            <div class="info-card">
                <h2>ğŸ¨ Use Cases</h2>
                <div class="use-cases">
                    <div class="use-case-item">
                        <strong>Privacy Protection:</strong> Blur faces, license plates, or sensitive information in photos
                    </div>
                    <div class="use-case-item">
                        <strong>Artistic Effects:</strong> Create pixelated art styles for creative projects
                    </div>
                    <div class="use-case-item">
                        <strong>Content Moderation:</strong> Censor inappropriate content before sharing
                    </div>
                    <div class="use-case-item">
                        <strong>Social Media:</strong> Protect privacy when posting images online
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- æ¡ˆä¾‹å±•ç¤ºéƒ¨åˆ† -->
    <section class="examples-section">
        <div class="examples-container">
            <h2>ğŸ“¸ Example Cases</h2>
            <div class="examples-grid">
                <!-- å…¨éƒ¨é©¬èµ›å…‹æ¡ˆä¾‹ -->
                <div class="example-card">
                    <h3>Full Mosaic Example</h3>
                    <div class="example-image-wrapper">
                        <img src="static/image/m1.png" alt="Full Mosaic Example" class="example-image">
                    </div>
                    <p class="example-description">
                        <strong>Full Mosaic Mode:</strong> Apply mosaic effect to the entire image. This mode is perfect for creating artistic pixelated effects or protecting privacy across the whole image.
                    </p>
                </div>

                <!-- å±€éƒ¨é©¬èµ›å…‹æ¡ˆä¾‹ -->
                <div class="example-card">
                    <h3>Partial Mosaic Example</h3>
                    <div class="example-image-wrapper">
                        <img src="static/image/m2.png" alt="Partial Mosaic Example" class="example-image">
                    </div>
                    <p class="example-description">
                        <strong>Partial Mosaic Mode:</strong> Select specific areas to apply mosaic effect. Use Rectangle or Brush mode to protect only the areas you want while keeping the rest of the image clear.
                    </p>
                </div>

                <!-- è§†é¢‘æ¡ˆä¾‹ -->
                <div class="example-card example-video-card">
                    <h3>Video Tutorial</h3>
                    <div class="example-video-wrapper">
                        <video src="static/image/mosaic.mp4" controls class="example-video" poster="">
                            Your browser does not support the video tag.
                        </video>
                    </div>
                    <p class="example-description">
                        <strong>Video Guide:</strong> Watch this tutorial video to learn how to use our Image Mosaic tool effectively. See step-by-step instructions for applying mosaic effects to protect privacy or create artistic effects.
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- ä¼šå‘˜å¥—é¤éƒ¨åˆ† -->
    <section class="pricing-section">
        <div class="pricing-container">
            <h2>ğŸ’ Membership Plans</h2>
            <div class="pricing-grid">
                <!-- æœˆåº¦å¥—é¤ -->
                <div class="pricing-card">
                    <div class="pricing-header">
                        <h3>Monthly Plan</h3>
                        <div class="price">$6.66<span>/month</span></div>
                    </div>
                    <ul class="pricing-features">
                        <li>âœ“ Unlimited image processing</li>
                        <li>âœ“ All mosaic modes</li>
                        <li>âœ“ High-resolution downloads</li>
                        <li>âœ“ Priority support</li>
                        <li>âœ“ Ad-free experience</li>
                    </ul>
                    <button class="pricing-btn">Subscribe Now</button>
                </div>

                <!-- å­£åº¦å¥—é¤ -->
                <div class="pricing-card featured">
                    <div class="pricing-badge">Best Value</div>
                    <div class="pricing-header">
                        <h3>Quarterly Plan</h3>
                        <div class="price">$16.66<span>/3 months</span></div>
                        <div class="price-save">Save 17%</div>
                    </div>
                    <ul class="pricing-features">
                        <li>âœ“ Everything in Monthly</li>
                        <li>âœ“ Batch processing</li>
                        <li>âœ“ Advanced filters</li>
                        <li>âœ“ API access</li>
                        <li>âœ“ Custom watermark</li>
                    </ul>
                    <button class="pricing-btn">Subscribe Now</button>
                </div>

                <!-- å¹´åº¦å¥—é¤ -->
                <div class="pricing-card">
                    <div class="pricing-header">
                        <h3>Annual Plan</h3>
                        <div class="price">$56.66<span>/year</span></div>
                        <div class="price-save">Save 33%</div>
                    </div>
                    <ul class="pricing-features">
                        <li>âœ“ Everything in Quarterly</li>
                        <li>âœ“ Unlimited storage</li>
                        <li>âœ“ White-label option</li>
                        <li>âœ“ Dedicated support</li>
                        <li>âœ“ Early access to new features</li>
                    </ul>
                    <button class="pricing-btn">Subscribe Now</button>
                </div>
            </div>
        </div>
    </section>

    <!-- é‚®ç®±è®¢é˜…éƒ¨åˆ† -->
    <section class="newsletter-section">
        <div class="newsletter-container">
            <h2>ğŸ“§ Subscribe to Our Newsletter</h2>
            <p>Get access to usage guides, use cases, and exclusive membership offers</p>
            <form class="newsletter-form" id="newsletterForm">
                <input type="email" placeholder="Enter your email address" required class="newsletter-input">
                <button type="submit" class="newsletter-btn">Subscribe</button>
            </form>
            <p class="newsletter-note">By subscribing, you'll receive usage guides, use cases, and membership information.</p>
        </div>
    </section>

    <!-- é¡µè„šéƒ¨åˆ† -->
    <footer class="site-footer">
        <div class="footer-container">
            <div class="footer-grid">
                <!-- å…³äºæˆ‘ä»¬ -->
                <div class="footer-column">
                    <h3>About Us</h3>
                    <p>Chuandao AI provides cutting-edge image processing tools to help you create, edit, and enhance your images with ease.</p>
                </div>

                <!-- è”ç³»æˆ‘ä»¬ -->
                <div class="footer-column">
                    <h3>Contact Us</h3>
                    <p>Email: <a href="mailto:support@chuandaoai.com">support@chuandaoai.com</a></p>
                    <p>We're here to help with any questions or concerns.</p>
                </div>

                <!-- éšç§æ”¿ç­– -->
                <div class="footer-column">
                    <h3>Privacy Policy</h3>
                    <p>We respect your privacy. All uploaded images are processed securely and are not stored on our servers.</p>
                    <a href="privacy.html" class="footer-link">Read More</a>
                </div>

                <!-- æœåŠ¡æ¡æ¬¾ -->
                <div class="footer-column">
                    <h3>Terms of Service</h3>
                    <p>By using our service, you agree to our terms and conditions.</p>
                    <a href="terms.html" class="footer-link">Read More</a>
                </div>
            </div>

            <!-- ç‰ˆæƒä¿¡æ¯ -->
            <div class="footer-bottom">
                <p>Copyright Â© Chuandao AI. All rights reserved.</p>
            </div>
        </div>
    </footer>
    <script type="text/javascript">

        var pix = 5;
        // æ¨¡å¼ä¸æ©è†œçŠ¶æ€
        var mode = 'full'; // full | rect | brush
        var brushSize = 30;
        var rectSelecting = false;
        var rectStart = null;
        var maskCanvas = null; // ä¸åŸå›¾åŒåƒç´ å°ºå¯¸

        // å¯¼èˆªèœå•åˆ‡æ¢åŠŸèƒ½
        document.addEventListener('DOMContentLoaded', function() {
            const navToggle = document.getElementById('navToggle');
            const navMenu = document.getElementById('navMenu');
            const navOverlay = document.getElementById('navOverlay');
            const navOriginalContainer = navMenu ? navMenu.parentElement : null;
            
            // æ£€æŸ¥æ˜¯å¦ä¸ºç§»åŠ¨ç«¯
            function isMobile() {
                return window.innerWidth <= 768;
            }
            
            function toggleMenu() {
                if (isMobile()) {
                    console.log('Toggle menu clicked');
                    navMenu.classList.toggle('nav-menu-active');
                    navToggle.classList.toggle('nav-toggle-active');
                    navOverlay.classList.toggle('nav-overlay-active');
                    
                    // ç¡®ä¿èœå•æ˜¾ç¤ºæ—¶ç§»é™¤éšè—çš„transform
                    if (navMenu.classList.contains('nav-menu-active')) {
                        navMenu.style.transform = 'translateX(0)';
                        // ç¦ç”¨é¡µé¢æ»šåŠ¨
                        document.body.classList.add('menu-open');
                        document.documentElement.classList.add('menu-open');
                        
                        // å¼ºåˆ¶è®¾ç½®èœå•æ»šåŠ¨å±æ€§
                        navMenu.style.overflowY = 'scroll';
                        navMenu.style.overflowX = 'hidden';
                        navMenu.style.height = '100vh';
                        navMenu.style.touchAction = 'pan-y';
                        navMenu.style.webkitOverflowScrolling = 'touch';
                        
                        // è¯Šæ–­ï¼šç»Ÿè®¡å­é¡¹é«˜åº¦æ€»å’Œ
                        const links = navMenu.querySelectorAll('.nav-link');
                        let totalItemsHeight = 0;
                        links.forEach(el => { totalItemsHeight += el.offsetHeight; });
                        console.log('Menu opened with scroll enabled');
                        console.log('Menu height:', navMenu.clientHeight, 'Content height:', navMenu.scrollHeight, 'Items sum:', totalItemsHeight, 'Count:', links.length);
                        console.log('Menu computed overflow-y:', getComputedStyle(navMenu).overflowY);

                        // å¼ºåˆ¶æ·»åŠ spacerç¡®ä¿å¯æ»šåŠ¨
                        let spacer = document.getElementById('__nav_spacer__');
                        if (spacer && spacer.parentElement === navMenu) {
                            navMenu.removeChild(spacer);
                        }
                        spacer = document.createElement('div');
                        spacer.id = '__nav_spacer__';
                        spacer.style.height = '300px';
                        spacer.style.width = '100%';
                        spacer.style.display = 'block';
                        spacer.style.pointerEvents = 'none';
                        spacer.style.backgroundColor = 'transparent';
                        spacer.style.flexShrink = '0';
                        navMenu.appendChild(spacer);
                        
                        // å¼ºåˆ¶é‡æ–°è®¡ç®—å¸ƒå±€
                        navMenu.offsetHeight;
                        
                        // å†æ¬¡è¾“å‡ºé«˜åº¦ä»¥éªŒè¯
                        setTimeout(function(){
                            console.log('After spacer -> Menu height:', navMenu.clientHeight, 'Content height:', navMenu.scrollHeight);
                            console.log('Spacer height:', spacer.offsetHeight);
                            console.log('Can scroll:', navMenu.scrollHeight > navMenu.clientHeight);
                            console.log('Scroll top:', navMenu.scrollTop, 'Max scroll:', navMenu.scrollHeight - navMenu.clientHeight);
                        }, 50);
                    } else {
                        navMenu.style.transform = 'translateX(-100%)';
                        // æ¢å¤é¡µé¢æ»šåŠ¨
                        document.body.classList.remove('menu-open');
                        document.documentElement.classList.remove('menu-open');
                        // æ¸…ç†å ä½
                        const spacer = document.getElementById('__nav_spacer__');
                        if (spacer && spacer.parentElement === navMenu) {
                            navMenu.removeChild(spacer);
                        }
                    }
                    
                    console.log('Menu classes:', navMenu.className);
                }
            }
            
            function closeMenu() {
                if (isMobile()) {
                    navMenu.classList.remove('nav-menu-active');
                    navToggle.classList.remove('nav-toggle-active');
                    navOverlay.classList.remove('nav-overlay-active');
                    navMenu.style.transform = 'translateX(-100%)';
                    // æ¢å¤é¡µé¢æ»šåŠ¨
                    document.body.classList.remove('menu-open');
                    document.documentElement.classList.remove('menu-open');
                }
            }

            // å°†èœå•åœ¨ç§»åŠ¨ç«¯æåˆ° body ç›´ä¸‹ï¼Œé¿å…ä»»ä½•çˆ¶çº§å±‚å ä¸Šä¸‹æ–‡/è£å‰ªå½±å“å±‚çº§
            function promoteMenuForMobile(){
                if (!navMenu) return;
                if (isMobile()) {
                    if (navMenu.parentElement !== document.body) {
                        document.body.appendChild(navMenu);
                    }
                    // ç¡®ä¿ç§»åŠ¨ç«¯èœå•æœ‰æ­£ç¡®çš„æ ·å¼
                    navMenu.style.display = 'flex';
                    navMenu.style.position = 'fixed';
                    navMenu.style.top = '0';
                    navMenu.style.left = '0';
                    navMenu.style.width = '380px';
                    navMenu.style.height = '100vh';
                    navMenu.style.background = '#ffffff';
                    navMenu.style.flexDirection = 'column';
                    navMenu.style.justifyContent = 'flex-start';
                    navMenu.style.alignItems = 'stretch';
                    navMenu.style.padding = '0';
                    navMenu.style.gap = '0';
                    navMenu.style.zIndex = '10001';
                    navMenu.style.boxShadow = '2px 0 10px rgba(0, 0, 0, 0.1)';
                    navMenu.style.overflowY = 'scroll';
                    navMenu.style.overflowX = 'hidden';
                    navMenu.style.webkitOverflowScrolling = 'touch';
                    navMenu.style.touchAction = 'pan-y';
                    navMenu.style.transition = 'transform .25s ease';
                    
                    // ä¿æŒèœå•çš„å½“å‰æ˜¾ç¤ºçŠ¶æ€ï¼Œä¸å¼ºåˆ¶éšè—
                    if (!navMenu.classList.contains('nav-menu-active')) {
                        navMenu.style.transform = 'translateX(-100%)';
                    } else {
                        navMenu.style.transform = 'translateX(0)';
                    }
                } else {
                    if (navOriginalContainer && navMenu.parentElement !== navOriginalContainer) {
                        navOriginalContainer.appendChild(navMenu);
                    }
                    // é‡ç½®PCç«¯æ ·å¼
                    navMenu.style.display = '';
                    navMenu.style.position = '';
                    navMenu.style.top = '';
                    navMenu.style.left = '';
                    navMenu.style.width = '';
                    navMenu.style.height = '';
                    navMenu.style.background = '';
                    navMenu.style.flexDirection = '';
                    navMenu.style.justifyContent = '';
                    navMenu.style.alignItems = '';
                    navMenu.style.padding = '';
                    navMenu.style.gap = '';
                    navMenu.style.zIndex = '';
                    navMenu.style.boxShadow = '';
                    navMenu.style.overflowY = '';
                    navMenu.style.webkitOverflowScrolling = '';
                    navMenu.style.transform = '';
                    navMenu.style.transition = '';
                }
            }
            promoteMenuForMobile();
            
            // åªåœ¨ç§»åŠ¨ç«¯æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
            if (navToggle) {
                navToggle.addEventListener('click', toggleMenu);
            }
            
            if (navOverlay) {
                navOverlay.addEventListener('click', closeMenu);
            }
            
            // ä¸‹æ‹‰èœå•ç‚¹å‡»å¤„ç†ï¼ˆç§»åŠ¨ç«¯ï¼‰
            const dropdownToggle = document.querySelector('.dropdown-toggle');
            const dropdownMenu = document.querySelector('.dropdown-menu');
            const navItem = document.querySelector('.nav-item');
            
            if (dropdownToggle && dropdownMenu && navItem) {
                let hideTimeout = null;
                
                // PCç«¯ï¼šç®€æ´çš„é¼ æ ‡æ‚¬åœé€»è¾‘
                if (!isMobile()) {
                    let hideTimer = null;
                    
                    function showMenu() {
                        if (hideTimer) {
                            clearTimeout(hideTimer);
                            hideTimer = null;
                        }
                        navItem.classList.add('dropdown-open');
                    }
                    
                    function hideMenu() {
                        hideTimer = setTimeout(function() {
                            navItem.classList.remove('dropdown-open');
                        }, 200);
                    }
                    
                    // é¼ æ ‡è¿›å…¥æ—¶æ˜¾ç¤º
                    navItem.addEventListener('mouseenter', showMenu);
                    dropdownMenu.addEventListener('mouseenter', showMenu);
                    
                    // é¼ æ ‡ç¦»å¼€æ—¶éšè—
                    navItem.addEventListener('mouseleave', function(e) {
                        if (e.relatedTarget && dropdownMenu.contains(e.relatedTarget)) {
                            return;
                        }
                        hideMenu();
                    });
                    
                    dropdownMenu.addEventListener('mouseleave', function(e) {
                        if (e.relatedTarget && navItem.contains(e.relatedTarget)) {
                            return;
                        }
                        hideMenu();
                    });
                }
                
                // ç§»åŠ¨ç«¯ç‚¹å‡»å¤„ç†
                dropdownToggle.addEventListener('click', function(e) {
                    if (isMobile()) {
                        e.preventDefault();
                        e.stopPropagation();
                        navItem.classList.toggle('dropdown-open');
                    }
                });
                
                // ç‚¹å‡»å¤–éƒ¨å…³é—­ä¸‹æ‹‰èœå•ï¼ˆä»…ç§»åŠ¨ç«¯ï¼‰
                document.addEventListener('click', function(e) {
                    if (isMobile() && !navItem.contains(e.target)) {
                        navItem.classList.remove('dropdown-open');
                    }
                });
            }
            
            // ç‚¹å‡»èœå•é¡¹åå…³é—­ç§»åŠ¨ç«¯èœå•
            const navLinks = document.querySelectorAll('.nav-link');
            navLinks.forEach(link => {
                let startX = 0, startY = 0, startT = 0;
                const threshold = 8; // å…è®¸çš„æ‰‹æŒ‡æŠ–åŠ¨
                function onStart(e){
                    if (!isMobile()) return;
                    const t = e.touches ? e.touches[0] : e;
                    startX = t.clientX; startY = t.clientY; startT = Date.now();
                }
                function onEnd(e){
                    if (!isMobile()) return;
                    const t = e.changedTouches ? e.changedTouches[0] : e;
                    const dx = Math.abs(t.clientX - startX);
                    const dy = Math.abs(t.clientY - startY);
                    const dt = Date.now() - startT;
                    if (dx < threshold && dy < threshold && dt < 1500) {
                        const href = link.getAttribute('href');
                        if (href) {
                            e.preventDefault(); e.stopPropagation();
                            window.location.assign(href);
                        }
                    }
                }
                link.addEventListener('touchstart', onStart, {passive:true, capture:true});
                link.addEventListener('touchend', onEnd, {passive:false, capture:true});
                link.addEventListener('mousedown', onStart, true);
                link.addEventListener('mouseup', onEnd, true);
                // å…œåº•ï¼šç‚¹å‡»äº‹ä»¶ï¼ˆé˜²æ­¢æŸäº›ç¯å¢ƒæœªè§¦å‘æŒ‡é’ˆåºåˆ—ï¼‰
                link.addEventListener('click', function(e){
                    if (!isMobile()) return;
                    const href = link.getAttribute('href');
                    if (href) { e.preventDefault(); e.stopPropagation(); window.location.assign(href); }
                }, true);
            });
            
            // çª—å£å¤§å°æ”¹å˜æ—¶é‡æ–°æ£€æŸ¥
            window.addEventListener('resize', function() {
                if (!isMobile()) {
                    closeMenu();
                } else {
                    // ç§»åŠ¨ç«¯æ—¶åªé‡æ–°åˆå§‹åŒ–æ ·å¼ï¼Œä¸æ”¹å˜èœå•æ˜¾ç¤ºçŠ¶æ€
                    promoteMenuForMobile();
                }
            });
            
            // é¡µé¢æ»šåŠ¨æ—¶ä¹Ÿé‡æ–°æ£€æŸ¥èœå•çŠ¶æ€ï¼Œä½†ä¸é‡ç½®èœå•æ˜¾ç¤ºçŠ¶æ€
            window.addEventListener('scroll', function() {
                if (isMobile()) {
                    // åªç¡®ä¿èœå•åœ¨æ­£ç¡®çš„ä½ç½®ï¼Œä¸æ”¹å˜æ˜¾ç¤ºçŠ¶æ€
                    if (navMenu.parentElement !== document.body) {
                        document.body.appendChild(navMenu);
                    }
                    // ä¿æŒèœå•çš„å½“å‰æ˜¾ç¤ºçŠ¶æ€
                    if (navMenu.classList.contains('nav-menu-active')) {
                        navMenu.style.transform = 'translateX(0)';
                    } else {
                        navMenu.style.transform = 'translateX(-100%)';
                    }
                }
            });
            
            // æ·»åŠ æ»šåŠ¨æµ‹è¯•ç›‘å¬å™¨
            if (navMenu) {
                navMenu.addEventListener('scroll', function() {
                    console.log('Menu scrolling detected:', navMenu.scrollTop);
                });
                console.log('Menu initialized with scroll listener');
            }
        });

        document.getElementById("fileBtn").addEventListener("change",function (e){
            if (window.FileReader) {
                var file = e.target.files[0];
                let reader = new FileReader();
                reader.onload = function (event) {
                    var dataURL = event.target.result;
                    var img = document.getElementById("img");
                    var convertImg = document.getElementById("convertImg");
                    var uploadPlaceholder = img.parentElement.querySelector('.placeholder-text');
                    var resultPlaceholder = convertImg.parentElement.querySelector('.placeholder-text');
                    
                    img.src = dataURL;
                    img.style.display = "block";
                    convertImg.style.display = "block";
                    uploadPlaceholder.style.display = "none";
                    resultPlaceholder.style.display = "none";
                    
                    // ç¡®ä¿ä¸¤ä¸ªå›¾ç‰‡çš„æ˜¾ç¤ºå°ºå¯¸ä¸€è‡´
                    img.onload = function() {
                        convertImg.style.width = img.offsetWidth + 'px';
                        convertImg.style.height = img.offsetHeight + 'px';
                        if (typeof window.__syncOverlaySize === 'function') {
                            window.__syncOverlaySize();
                        }
                    };
                };
Â Â Â Â Â Â Â Â Â Â Â Â     reader.readAsDataURL(file);
            } else {
                alert("æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒæ›´æ”¹åŠŸèƒ½");
            }
        });

        document.getElementById("img").addEventListener("load",function (e){
            if (e.target.src) {
                showConvertPic();
            }
        });


        document.getElementById("rangeInput").addEventListener("change", function (e) {
            if (document.getElementById("img").src) {
                pix = parseInt(e.target.value);
                document.getElementById("rangeValue").textContent = pix;
                showConvertPic();
            }
        });

        document.getElementById("downloadBtn").addEventListener("click",function (e){
            var convertImg = document.getElementById("convertImg");
            if(!!convertImg.src){
                download(convertImg.src);
            } else {
                alert("è¯·å…ˆä¸Šä¼ å›¾ç‰‡");
            }
        });

        // Remove mosaic processing
        (function(){
            function createDeMosaicPic(img){
                if(!img || !img.naturalWidth) return null;
                var srcW = img.naturalWidth, srcH = img.naturalHeight;
                var scale = 3; // upscale factor to smooth pixel blocks
                // upscale with smoothing
                var up = document.createElement('canvas');
                up.width = srcW * scale; up.height = srcH * scale;
                var uctx = up.getContext('2d');
                uctx.imageSmoothingEnabled = true;
                uctx.imageSmoothingQuality = 'high';
                uctx.drawImage(img, 0, 0, up.width, up.height);
                // downscale back with smoothing
                var down = document.createElement('canvas');
                down.width = srcW; down.height = srcH;
                var dctx = down.getContext('2d');
                dctx.imageSmoothingEnabled = true;
                dctx.imageSmoothingQuality = 'high';
                dctx.drawImage(up, 0, 0, down.width, down.height);
                return down.toDataURL();
            }

            var removeBtn = document.getElementById('removeMosaicBtn');
            if(removeBtn){
                removeBtn.addEventListener('click', function(){
                    var img = document.getElementById('img');
                    var convertImg = document.getElementById('convertImg');
                    if(!img || !img.src){
                        alert('Please upload an image first');
                        return;
                    }
                    var result = createDeMosaicPic(img);
                    if(result){
                        convertImg.src = result;
                        convertImg.style.display = 'block';
                        // match display size with the left image
                        convertImg.style.width = img.style.width || (img.offsetWidth + 'px');
                        convertImg.style.height = img.style.height || (img.offsetHeight + 'px');
                        var resultPlaceholder = convertImg.parentElement.querySelector('.placeholder-text');
                        if(resultPlaceholder){ resultPlaceholder.style.display = 'none'; }
                    }
                });
            }
        })();

        function showConvertPic(){
            var img = document.getElementById("img");
            var convertImg = document.getElementById("convertImg");
            convertImg.src = createRevertPic(img);
            
            // ç¡®ä¿å³è¾¹å›¾ç‰‡çš„æ˜¾ç¤ºå°ºå¯¸ä¸å·¦è¾¹å›¾ç‰‡ä¸€è‡´
            convertImg.style.width = img.style.width || img.offsetWidth + 'px';
            convertImg.style.height = img.style.height || img.offsetHeight + 'px';
        }

        function createRevertPic(img){
            var canvas = document.createElement("canvas");
            // ä½¿ç”¨å›¾ç‰‡çš„åŸå§‹å°ºå¯¸ï¼Œè€Œä¸æ˜¯æ˜¾ç¤ºå°ºå¯¸
            canvas.width = img.naturalWidth;   
            canvas.height = img.naturalHeight;
            var ctx = canvas.getContext("2d");
            ctx.drawImage(img, 0, 0, img.naturalWidth, img.naturalHeight);  
            var c = ctx.getImageData(0, 0, img.naturalWidth, img.naturalHeight);
            var height = c.height;
            var width = c.width;
            for(var i = 0; i < height; i+=pix){
                for(var j = 0; j < width; j+=pix){
                    var rAvg = 0;
                    var gAvg = 0;
                    var bAvg = 0;
                    var aAvg = 0;
                    var count = 0;
                    outerFor:for (var iPix = i; iPix < i+pix; iPix++) {
                        for (var jPix = j; jPix < j+pix; jPix++) {
                            if (iPix > height) {
                                break;
                            } else if(jPix>width){
                                break outerFor;
                            }
                            var x = iPix*4*width + 4*jPix;
                            count++;
                            rAvg += c.data[x];
                            gAvg += c.data[x+1];
                            bAvg += c.data[x+2];
                            aAvg += c.data[x+3];
                        }
                        
                    }
                    rAvg /= (count);
                    gAvg /= (count);
                    bAvg /= (count);
                    aAvg /= (count);

                    outerFor:for (var iPix = i; iPix < i+pix; iPix++) {
                        for (var jPix = j; jPix < j+pix; jPix++) {
                            if (iPix > height) {
                                break;
                            } else if(jPix>width){
                                break outerFor;
                            }
                            var x = iPix*4*width + 4*jPix;
                            c.data[x] = rAvg
                            c.data[x+1] = gAvg;
                            c.data[x+2] = bAvg; 
                            c.data[x+3] = aAvg;
                        }
                    }
                }
            }
            ctx.putImageData(c,0,0);
            return canvas.toDataURL();
        }


        function download(src) {
            var $a = document.createElement('a');
            $a.setAttribute("href", src);
            $a.setAttribute("download", "");

            var evObj = document.createEvent('MouseEvents');
            evObj.initMouseEvent('click', true, true, window, 0, 0, 0, 0, 0, false, false, true, false, 0, null);
            $a.dispatchEvent(evObj);
        };

        
        // ========= è¦†ç›–å±‚å°ºå¯¸åŒæ­¥ =========
        (function(){
            var overlayCanvas = document.getElementById('overlayCanvas');
            if(!overlayCanvas) return;
            function syncOverlaySize(){
                var img = document.getElementById('img');
                if(!img || img.style.display!=="block") return;
                // åŒæ­¥å°ºå¯¸
                overlayCanvas.width = img.offsetWidth;
                overlayCanvas.height = img.offsetHeight;
                overlayCanvas.style.width = img.offsetWidth + 'px';
                overlayCanvas.style.height = img.offsetHeight + 'px';
                // åŒæ­¥ä½ç½®ï¼ˆç›¸å¯¹å…¶å®šä½çˆ¶å®¹å™¨ï¼‰
                overlayCanvas.style.left = img.offsetLeft + 'px';
                overlayCanvas.style.top = img.offsetTop + 'px';
            }
            document.getElementById('img').addEventListener('load', function(){
                syncOverlaySize();
            });
            window.addEventListener('resize', function(){
                syncOverlaySize();
            });
            // æš´éœ²åˆ°å…¨å±€ä»¥ä¾¿æ–‡ä»¶è½½å…¥å›è°ƒä¹Ÿå¯è°ƒç”¨
            window.__syncOverlaySize = syncOverlaySize;
        })();

        // ========= æ©è†œä¸ç¼©æ”¾ =========
        function ensureMaskCanvas(){
            var img = document.getElementById('img');
            if(!img || !img.naturalWidth) return;
            if(!maskCanvas || maskCanvas.width!==img.naturalWidth || maskCanvas.height!==img.naturalHeight){
                maskCanvas = document.createElement('canvas');
                maskCanvas.width = img.naturalWidth;
                maskCanvas.height = img.naturalHeight;
                var mctx = maskCanvas.getContext('2d');
                mctx.clearRect(0,0,maskCanvas.width,maskCanvas.height);
            }
        }

        function getScale(){
            var img = document.getElementById('img');
            var sx = img.naturalWidth / img.offsetWidth;
            var sy = img.naturalHeight / img.offsetHeight;
            return {sx, sy};
        }

        // ========= è¦†ç›–å±‚äº¤äº’ï¼ˆçŸ©å½¢ä¸ç”»ç¬”ï¼‰ =========
        (function(){
            var overlayCanvas = document.getElementById('overlayCanvas');
            if(!overlayCanvas) return;
            var octx = overlayCanvas.getContext('2d');
            var isDrawing = false;
            var startPoint = null;

            function drawBrush(x,y){
                // é¢„è§ˆ
                octx.fillStyle = 'rgba(255,0,0,0.25)';
                octx.beginPath();
                octx.arc(x,y, brushSize/2, 0, Math.PI*2);
                octx.fill();
                // æ©è†œ
                ensureMaskCanvas();
                if(!maskCanvas) return;
                var {sx, sy} = getScale();
                var mctx = maskCanvas.getContext('2d');
                mctx.fillStyle = 'rgba(255,255,255,1)';
                mctx.beginPath();
                mctx.arc(x*sx, y*sy, (brushSize/2)*sx, 0, Math.PI*2);
                mctx.fill();
            }

            function drawRectPreview(p1, p2){
                octx.clearRect(0,0,overlayCanvas.width,overlayCanvas.height);
                octx.fillStyle = 'rgba(255,0,0,0.25)';
                var x = Math.min(p1.x, p2.x);
                var y = Math.min(p1.y, p2.y);
                var w = Math.abs(p1.x - p2.x);
                var h = Math.abs(p1.y - p2.y);
                octx.fillRect(x,y,w,h);
            }

            function commitRect(p1, p2){
                ensureMaskCanvas();
                if(!maskCanvas) return;
                var {sx, sy} = getScale();
                var mx = Math.min(p1.x, p2.x) * sx;
                var my = Math.min(p1.y, p2.y) * sy;
                var mw = Math.abs(p1.x - p2.x) * sx;
                var mh = Math.abs(p1.y - p2.y) * sy;
                var mctx = maskCanvas.getContext('2d');
                mctx.fillStyle = 'rgba(255,255,255,1)';
                mctx.fillRect(mx,my,mw,mh);
            }

            function getPos(e){
                var rect = overlayCanvas.getBoundingClientRect();
                return {x: e.clientX - rect.left, y: e.clientY - rect.top};
            }

            // é¼ æ ‡äº‹ä»¶
            overlayCanvas.addEventListener('mousedown', function(e){
                if(mode==='full') return;
                isDrawing = true;
                var p = getPos(e);
                if(mode==='brush'){
                    drawBrush(p.x, p.y);
                }else if(mode==='rect'){
                    rectSelecting = true;
                    startPoint = p;
                    drawRectPreview(startPoint, startPoint);
                }
            });
            overlayCanvas.addEventListener('mousemove', function(e){
                if(!isDrawing) return;
                var p = getPos(e);
                if(mode==='brush'){
                    drawBrush(p.x, p.y);
                }else if(mode==='rect' && rectSelecting){
                    drawRectPreview(startPoint, p);
                }
            });
            window.addEventListener('mouseup', function(e){
                if(!isDrawing) return;
                isDrawing = false;
                if(mode==='rect' && rectSelecting){
                    var p = getPos(e);
                    // ä¸æ¸…ç©ºæ©è†œï¼Œæ–°çš„çŸ©å½¢ä¸å·²æœ‰é€‰æ‹©å åŠ 
                    commitRect(startPoint, p);
                    rectSelecting = false;
                    // æ¸…ç†é¢„è§ˆ
                    octx.clearRect(0,0,overlayCanvas.width,overlayCanvas.height);
                }
                showConvertPic();
            });

            // è§¦æ‘¸äº‹ä»¶
            overlayCanvas.addEventListener('touchstart', function(e){
                if(mode==='full') return;
                var t = e.touches[0];
                var evt = {clientX:t.clientX, clientY:t.clientY};
                isDrawing = true;
                var p = getPos(evt);
                if(mode==='brush'){
                    drawBrush(p.x, p.y);
                }else if(mode==='rect'){
                    rectSelecting = true;
                    startPoint = p;
                    drawRectPreview(startPoint, startPoint);
                }
                e.preventDefault();
            }, {passive:false});
            overlayCanvas.addEventListener('touchmove', function(e){
                if(!isDrawing) return;
                var t = e.touches[0];
                var evt = {clientX:t.clientX, clientY:t.clientY};
                var p = getPos(evt);
                if(mode==='brush'){
                    drawBrush(p.x, p.y);
                }else if(mode==='rect' && rectSelecting){
                    drawRectPreview(startPoint, p);
                }
                e.preventDefault();
            }, {passive:false});
            overlayCanvas.addEventListener('touchend', function(e){
                if(!isDrawing) return;
                isDrawing = false;
                if(mode==='rect' && rectSelecting){
                    rectSelecting = false;
                }
                showConvertPic();
                e.preventDefault();
            }, {passive:false});
        })();

        // ========= æ¨¡å¼ä¸ç”»ç¬”æ§ä»¶ =========
        (function(){
            var modeSelect = document.getElementById('modeSelect');
            var brushInput = document.getElementById('brushSize');
            var brushGroup = document.getElementById('brushGroup');
            var overlayCanvas = document.getElementById('overlayCanvas');
            var clearBtn = document.getElementById('clearMaskBtn');

            if(modeSelect){
                modeSelect.addEventListener('change', function(e){
                    mode = e.target.value;
                    if(mode==='brush'){
                        brushGroup.style.display = 'inline-flex';
                        if(document.getElementById('img').style.display==='block') overlayCanvas.style.display = 'block';
                    }else if(mode==='rect'){
                        brushGroup.style.display = 'none';
                        if(document.getElementById('img').style.display==='block') overlayCanvas.style.display = 'block';
                    }else{
                        brushGroup.style.display = 'none';
                        overlayCanvas.style.display = 'none';
                    }
                    showConvertPic();
                });
            }
            if(brushInput){
                brushInput.addEventListener('input', function(e){
                    brushSize = parseInt(e.target.value,10);
                    document.getElementById('brushValue').textContent = brushSize;
                });
            }
            if(clearBtn){
                clearBtn.addEventListener('click', function(){
                    var octx = overlayCanvas.getContext('2d');
                    octx.clearRect(0,0,overlayCanvas.width,overlayCanvas.height);
                    if(maskCanvas){
                        var mctx = maskCanvas.getContext('2d');
                        mctx.clearRect(0,0,maskCanvas.width,maskCanvas.height);
                    }
                    showConvertPic();
                });
            }
        })();

        // ========= è¦†ç›– createRevertPic ä»¥æ”¯æŒæ©è†œ =========
        (function(){
            var originalCreate = createRevertPic;
            createRevertPic = function(img){
                var canvas = document.createElement("canvas");
                canvas.width = img.naturalWidth;
                canvas.height = img.naturalHeight;
                var ctx = canvas.getContext("2d");
                ctx.drawImage(img, 0, 0, img.naturalWidth, img.naturalHeight);
                var c = ctx.getImageData(0, 0, img.naturalWidth, img.naturalHeight);
                var height = c.height;
                var width = c.width;

                var useMask = (mode !== 'full');
                var maskData = null;
                if(useMask){
                    ensureMaskCanvas();
                    if(maskCanvas){
                        var mctx = maskCanvas.getContext('2d');
                        maskData = mctx.getImageData(0,0,maskCanvas.width,maskCanvas.height).data;
                    }
                }

                for(var i = 0; i < height; i+=pix){
                    for(var j = 0; j < width; j+=pix){
                        if(useMask){
                            // ä»¥å—ä¸­å¿ƒåƒç´ åˆ¤æ–­æ˜¯å¦åœ¨æ©è†œä¸­ï¼Œå‘½ä¸­æ›´ç¨³å®š
                            var ci = Math.min(i + Math.floor(pix/2), height - 1);
                            var cj = Math.min(j + Math.floor(pix/2), width - 1);
                            var mIndex = (ci*width + cj) * 4;
                            var marked = maskData && maskData[mIndex+3] > 0;
                            if(!marked){
                                continue;
                            }
                        }
                        var rAvg = 0, gAvg = 0, bAvg = 0, aAvg = 0, count = 0;
                        outerFor: for (var iPix = i; iPix < i+pix; iPix++) {
                            for (var jPix = j; jPix < j+pix; jPix++) {
                                if (iPix > height) {
                                    break;
                                } else if(jPix>width){
                                    break outerFor;
                                }
                                var x = iPix*4*width + 4*jPix;
                                count++;
                                rAvg += c.data[x];
                                gAvg += c.data[x+1];
                                bAvg += c.data[x+2];
                                aAvg += c.data[x+3];
                            }
                        }
                        rAvg /= count; gAvg /= count; bAvg /= count; aAvg /= count;
                        outerFor: for (var iPix2 = i; iPix2 < i+pix; iPix2++) {
                            for (var jPix2 = j; jPix2 < j+pix; jPix2++) {
                                if (iPix2 > height) {
                                    break;
                                } else if(jPix2>width){
                                    break outerFor;
                                }
                                var x2 = iPix2*4*width + 4*jPix2;
                                c.data[x2] = rAvg;
                                c.data[x2+1] = gAvg;
                                c.data[x2+2] = bAvg;
                                c.data[x2+3] = aAvg;
                            }
                        }
                    }
                }
                ctx.putImageData(c,0,0);
                return canvas.toDataURL();
            }
        })();

         
    </script>  

    <!-- é‚®ç®±è®¢é˜…åŠŸèƒ½ -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const newsletterForm = document.getElementById('newsletterForm');
            
            if (newsletterForm) {
                newsletterForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const emailInput = this.querySelector('.newsletter-input');
                    const email = emailInput.value.trim();
                    
                    if (email) {
                        // è¿™é‡Œå¯ä»¥æ·»åŠ å®é™…çš„è®¢é˜…é€»è¾‘ï¼Œæ¯”å¦‚å‘é€åˆ°åç«¯API
                        alert('Thank you for subscribing! You will receive usage guides, use cases, and membership information.');
                        emailInput.value = '';
                        
                        // ç¤ºä¾‹ï¼šå¯ä»¥å‘é€åˆ°åç«¯
                        // fetch('/api/subscribe', {
                        //     method: 'POST',
                        //     headers: { 'Content-Type': 'application/json' },
                        //     body: JSON.stringify({ email: email })
                        // })
                        // .then(response => response.json())
                        // .then(data => {
                        //     alert('Thank you for subscribing!');
                        //     emailInput.value = '';
                        // })
                        // .catch(error => {
                        //     alert('Subscription failed. Please try again.');
                        // });
                    }
                });
            }
        });
    </script>  

    <!-- Shared Auth Module -->
    <script src="js/auth.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function(){
            if (window.AppAuth && typeof window.AppAuth.init === 'function') {
                window.AppAuth.init({
                    loginButtonId: 'loginBtn',
                    loginLabelId: 'loginLabel'
                });
            }
        });
    </script>

</body>
</html>
